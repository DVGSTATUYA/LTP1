{% extends "base.html" %}
{% block content %}
<h2>üìê –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h2>

<form method="post" id="calc-form">
  <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑–¥–µ–ª–∏—è:</label><br>
  <select name="product_type_id" id="product_type_id" required>
    {% for pt in product_types %}
      <option value="{{ pt.id }}" {{ selected_type_id == pt.id|string and "selected" or "" }}>
        {{ pt.product_type }}
      </option>
    {% endfor %}
  </select><br><br>

  <label>–ú–∞—Ç–µ—Ä–∏–∞–ª:</label><br>
  <select name="material_type_id" id="material_type_id" required>
    {% for mt in material_types %}
      <option value="{{ mt.id }}" {{ selected_material_id == mt.id|string and "selected" or "" }}>
        {{ mt.type_material }}
      </option>
    {% endfor %}
  </select><br><br>

  <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–¥–µ–ª–∏–π:</label><br>
  <input type="number" name="quantity" value="1" min="1" required><br><br>

  <label id="param1_label">{{ labels[0] }}</label><br>
  <input type="number" step="0.0001" name="param1" required><br><br>

  <label id="param2_label">{{ labels[1] }}</label><br>
  <input type="number" step="0.0001" name="param2" required><br><br>

  <button type="submit" style="background:#355CBD; color:#fff; padding:8px 16px; border:none; border-radius:4px;">üìä –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
  <a href="{{ url_for('products') }}" style="margin-left:10px;">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</a>
</form>

{% if result is not none %}
  {% if result == -1 %}
    <p><strong>‚ö†Ô∏è –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞—Ö.</strong></p>
  {% else %}
    <p><strong>‚úÖ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ã—Ä—å—è: {{ result }} –µ–¥.</strong></p>
  {% endif %}
{% endif %}

<script>
  // –ö–∞—Ä—Ç–∞ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–æ–¥–ø–∏—Å–µ–π
  const labelMap = {
    "–ì–æ—Å—Ç–∏–Ω—ã–µ": ["–ü–ª–æ—â–∞–¥—å (–º¬≤)", "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏"],
    "–ü—Ä–∏—Ö–æ–∂–∏–µ": ["–®–∏—Ä–∏–Ω–∞ (–º)", "–í—ã—Å–æ—Ç–∞ (–º)"],
    "–ú—è–≥–∫–∞—è –º–µ–±–µ–ª—å": ["–û–±—ä—ë–º (–º¬≥)", "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –Ω–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—è"],
    "–ö—Ä–æ–≤–∞—Ç–∏": ["–î–ª–∏–Ω–∞ (–º)", "–®–∏—Ä–∏–Ω–∞ (–º)"],
    "–®–∫–∞—Ñ—ã": ["–®–∏—Ä–∏–Ω–∞ (–º)", "–í—ã—Å–æ—Ç–∞ (–º)"],
    "–ö–æ–º–æ–¥—ã": ["–ü–ª–æ—â–∞–¥—å —Ñ–∞—Å–∞–¥–∞ (–º¬≤)", "–¢–æ–ª—â–∏–Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ (–º–º)"]
  };

  const ptSelect = document.getElementById("product_type_id");
  const p1Label = document.getElementById("param1_label");
  const p2Label = document.getElementById("param2_label");
  const typeNames = {{ product_types|tojson }};

  function updateLabels() {
    const chosenId = parseInt(ptSelect.value, 10);
    const chosen = typeNames.find(t => t.id === chosenId);
    const name = chosen ? chosen.product_type : null;
    const labels = labelMap[name] || ["–ü–∞—Ä–∞–º–µ—Ç—Ä 1", "–ü–∞—Ä–∞–º–µ—Ç—Ä 2"];
    p1Label.textContent = labels[0];
    p2Label.textContent = labels[1];
  }

  ptSelect.addEventListener("change", updateLabels);
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  updateLabels();
</script>
{% endblock %}
